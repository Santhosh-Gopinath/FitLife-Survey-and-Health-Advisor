<!DOCTYPE html>  
<html lang="en">  
<head>  
    <meta charset="UTF-8">  
    <meta name="viewport" content="width=device-width, initial-scale=1.0">  
    <title>Profile Form</title>
    <!-- Adding Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <style>  
        body {  
            font-family: Arial, sans-serif;  
            background-color: #f4f4f4;  
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
        }  
        .container {
            width: 100%;
            max-width: 600px;
        }
        h2 {
            text-align: center;
            color: #333;
            margin-bottom: 20px;
        }
        form {  
            background: white;  
            padding: 30px;  
            border-radius: 8px;  
            box-shadow: 0 3px 15px rgba(0, 0, 0, 0.1);
            width: 100%;
        }  
        .form-group {
            margin-bottom: 15px;
            position: relative;
        }
        label {  
            display: block;  
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }  
        .input-with-icon {
            position: relative;
        }
        .icon {
            position: absolute;
            left: 10px;
            top: 10px;
            color: #666;
            font-size: 18px;
        }
        input, select, textarea {  
            width: 100%;  
            padding: 10px 10px 10px 40px;  
            border: 1px solid #ddd;  
            border-radius: 4px;
            font-size: 16px;
            box-sizing: border-box;
            transition: border-color 0.3s;
        }  
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #4CAF50;
            box-shadow: 0 0 5px rgba(76, 175, 80, 0.3);
        }
        button {  
            background-color: #4CAF50;  
            color: white;  
            padding: 12px 20px;  
            border: none;  
            border-radius: 4px;  
            cursor: pointer;
            font-size: 16px;
            width: 100%;
            margin-top: 10px;
            transition: background-color 0.3s;
        }  
        button:hover {  
            background-color: #45a049;  
        }  
        .error {  
            color: #e74c3c;  
            font-size: 0.85em;  
            display: none;
            margin-top: 5px;
        }  
        .input-error {  
            border-color: #e74c3c;  
        }
        .form-header {
            text-align: center;
            margin-bottom: 25px;
        }
        .form-icon {
            font-size: 50px;
            color: #4CAF50;
            margin-bottom: 15px;
        }
    </style>  
</head>  
<body>  

<div class="container">
    <div class="form-header">
        <i class="fas fa-user-circle form-icon"></i>
        <h2>Profile Form</h2>
    </div>
    
    <form action="/insert" method="POST" id="personalForm" onsubmit="return validateForm(event)"> 
        <div class="form-group">
            <label for="full-name">Full Name:</label>
            <div class="input-with-icon">
                <i class="fas fa-user icon"></i>
                <input type="text" id="full-name" name="full_name" required>
            </div>
            <span id="full-name-error" class="error">Please enter your full name</span>
        </div>
        
        <div class="form-group">
            <label for="date-of-birth">Date Of Birth:</label>
            <div class="input-with-icon">
                <i class="fas fa-calendar-alt icon"></i>
                <input type="date" id="date-of-birth" name="date_of_birth" required>
            </div>
            <span id="date-of-birth-error" class="error">Please enter a valid date of birth</span>
        </div>
        
        <div class="form-group">
            <label for="age">Age:</label>
            <div class="input-with-icon">
                <i class="fas fa-birthday-cake icon"></i>
                <input type="number" id="age" name="age" min="0" max="100" required>
            </div>
            <span id="age-error" class="error">Please enter a valid age (0-100)</span>
        </div>
        
        <div class="form-group">
            <label for="gender">Gender:</label>
            <div class="input-with-icon">
                <i class="fas fa-venus-mars icon"></i>
                <select id="gender" name="gender" required>
                    <option value="">Select Gender</option>
                    <option value="male">Male</option>
                    <option value="female">Female</option>
                    <option value="other">Other</option>
                </select>
            </div>
            <span id="gender-error" class="error">Please select your gender</span>
        </div>
        
        <div class="form-group">
            <label for="blood-group">Blood Group:</label>
            <div class="input-with-icon">
                <i class="fas fa-tint icon"></i>
                <select id="blood-group" name="blood_group" required>
                    <option value="">Select Blood Group</option>
                    <option value="A+">A+</option>
                    <option value="A-">A-</option>
                    <option value="B+">B+</option>
                    <option value="B-">B-</option>
                    <option value="AB+">AB+</option>
                    <option value="AB-">AB-</option>
                    <option value="O+">O+</option>
                    <option value="O-">O-</option>
                </select>
            </div>
            <span id="blood-group-error" class="error">Please select your blood group</span>
        </div>
        
        <div class="form-group">
            <label for="height">Height (cm):</label>
            <div class="input-with-icon">
                <i class="fas fa-ruler-vertical icon"></i>
                <input type="number" id="height" name="height" min="50" max="250" required>
            </div>
            <span id="height-error" class="error">Please enter a valid height (50-250 cm)</span>
        </div>
        
        <div class="form-group">
            <label for="weight">Weight (kg):</label>
            <div class="input-with-icon">
                <i class="fas fa-weight icon"></i>
                <input type="number" id="weight" name="weight" min="1" max="500" step="0.1" required>
            </div>
            <span id="weight-error" class="error">Please enter a valid weight (1-500 kg)</span>
        </div>
        
        <div class="form-group">
            <label for="phone-no">Phone No:</label>
            <div class="input-with-icon">
                <i class="fas fa-phone icon"></i>
                <input type="tel" id="phone-no" name="phone_no" required>
            </div>
            <span id="phone-no-error" class="error">Please enter a valid phone number (10 digits or format: 123-456-7890)</span>
        </div>
        
        <div class="form-group">
            <label for="gmail">Gmail:</label>
            <div class="input-with-icon">
                <i class="fas fa-envelope icon"></i>
                <input type="email" id="gmail" name="gmail" required>
            </div>
            <span id="gmail-error" class="error">Please enter a valid email address</span>
        </div>
        
        <div class="form-group">
            <label for="address">Address:</label>
            <div class="input-with-icon">
                <i class="fas fa-home icon"></i>
                <textarea id="address" name="address" rows="3" style="padding-left: 40px;" required></textarea>
            </div>
            <span id="address-error" class="error">Please enter your address</span>
        </div>

        <button type="submit"><i class="fas fa-paper-plane"></i> Submit</button>  
    </form>
</div>

<script>
function validateForm(event) {
    event.preventDefault();
    let isValid = true;
    
    // Reset error states
    document.querySelectorAll('.error').forEach(error => error.style.display = 'none');
    document.querySelectorAll('input, select, textarea').forEach(input => input.classList.remove('input-error'));

    // Full Name validation
    const fullName = document.getElementById('full-name');
    if (fullName.value.trim().length < 3) {
        showError('full-name', 'full-name-error');
        isValid = false;
    }

    // Date of Birth validation
    const dob = document.getElementById('date-of-birth');
    if (!dob.value) {
        showError('date-of-birth', 'date-of-birth-error');
        isValid = false;
    }

    // Age validation
    const age = document.getElementById('age');
    if (!age.value || age.value < 0 || age.value > 100) {
        showError('age', 'age-error');
        isValid = false;
    }

    // Gender validation
    const gender = document.getElementById('gender');
    if (!gender.value) {
        showError('gender', 'gender-error');
        isValid = false;
    }

    // Blood Group validation
    const bloodGroup = document.getElementById('blood-group');
    if (!bloodGroup.value) {
        showError('blood-group', 'blood-group-error');
        isValid = false;
    }

    // Height validation
    const height = document.getElementById('height');
    if (!height.value || height.value < 50 || height.value > 250) {
        showError('height', 'height-error');
        isValid = false;
    }

    // Weight validation
    const weight = document.getElementById('weight');
    if (!weight.value || weight.value < 1 || weight.value > 500) {
        showError('weight', 'weight-error');
        isValid = false;
    }

    // Phone validation
    const phone = document.getElementById('phone-no');
    const phoneRegex = /^\d{3}-\d{3}-\d{4}$|^\d{10}$/;
    if (!phoneRegex.test(phone.value)) {
        showError('phone-no', 'phone-no-error');
        isValid = false;
    }

    // Email validation
    const email = document.getElementById('gmail');
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!emailRegex.test(email.value)) {
        showError('gmail', 'gmail-error');
        isValid = false;
    }

    // Address validation
    const address = document.getElementById('address');
    if (address.value.trim().length < 5) {
        showError('address', 'address-error');
        isValid = false;
    }

    if (isValid) {
        // If all validations pass, you can submit the form
        alert('Form submitted successfully!');
        document.getElementById('personalForm').submit();
    }

    return isValid;
}

function showError(inputId, errorId) {
    document.getElementById(inputId).classList.add('input-error');
    document.getElementById(errorId).style.display = 'block';
}

// Real-time validation for better user experience
document.querySelectorAll('input, select, textarea').forEach(input => {
    input.addEventListener('input', () => {
        validateField(input);
    });
});

function validateField(input) {
    const fieldName = input.id;
    const value = input.value;

    switch(fieldName) {
        case 'full-name':
            toggleError(fieldName, value.trim().length < 3);
            break;
        case 'age':
            toggleError(fieldName, !value || value < 0 || value > 100);
            break;
        case 'height':
            toggleError(fieldName, !value || value < 50 || value > 250);
            break;
        case 'weight':
            toggleError(fieldName, !value || value < 1 || value > 500);
            break;
        case 'phone-no':
            const phoneRegex = /^\d{3}-\d{3}-\d{4}$|^\d{10}$/;
            toggleError(fieldName, !phoneRegex.test(value));
            break;
        case 'gmail':
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            toggleError(fieldName, !emailRegex.test(value));
            break;
        case 'address':
            toggleError(fieldName, value.trim().length < 5);
            break;
    }
}

function toggleError(inputId, show) {
    const input = document.getElementById(inputId);
    const error = document.getElementById(`${inputId}-error`);
    if (show) {
        input.classList.add('input-error');
        error.style.display = 'block';
    } else {
        input.classList.remove('input-error');
        error.style.display = 'none';
    }
}

// Add this to the form submission handler in your frontend
document.getElementById('profileForm').addEventListener('submit', async (e) => {
  e.preventDefault();

  const formData = {
    fullName: document.getElementById('full-name').value,
    dateOfBirth: document.getElementById('date-of-birth').value,
    age: document.getElementById('age').value,
    gender: document.getElementById('gender').value,
    bloodGroup: document.getElementById('blood-group').value,
    height: document.getElementById('height').value,
    weight: document.getElementById('weight').value,
    phoneNo: document.getElementById('phone-no').value,
    address: document.getElementById('address').value,
  };

  console.log('Submitting profile data:', formData); // Debugging log

  try {
    const response = await fetch('/api/profile', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'x-auth-token': localStorage.getItem('fitnexusToken'), // Ensure token is sent
      },
      body: JSON.stringify(formData),
    });

    const result = await response.json();
    console.log('Response from server:', result); // Debugging log

    if (response.ok) {
      alert('Profile saved successfully!');
    } else {
      alert(`Error: ${result.msg}`);
    }
  } catch (error) {
    console.error('Error submitting profile:', error);
    alert('An error occurred while saving the profile.');
  }
});

// Auto-calculate age based on date of birth
document.getElementById('date-of-birth').addEventListener('change', function() {
    const dob = new Date(this.value);
    const today = new Date();
    let age = today.getFullYear() - dob.getFullYear();
    const monthDiff = today.getMonth() - dob.getMonth();
    
    if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < dob.getDate())) {
        age--;
    }
    
    if (age >= 0 && age <= 100) {
        document.getElementById('age').value = age;
        validateField(document.getElementById('age'));
    }
});
</script>

</body>  
</html>
